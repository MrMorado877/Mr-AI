<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MORADO AI</title>

<style>
:root{
  --bg:#0f0f0f;
  --panel:#1a1a1a;
  --border:#2a2a2a;
  --text:#e5e5e5;
  --muted:#9a9a9a;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:var(--bg);
  color:var(--text);
  display:flex;
  height:100vh;
}

/* ---------- SIDEBAR ---------- */
#sidebar{
  width:260px;
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:16px;
  display:flex;
  flex-direction:column;
}

#brand{
  font-size:20px;
  font-weight:600;
  margin-bottom:20px;
}

.sidebar-btn{
  padding:10px;
  border-radius:8px;
  cursor:pointer;
  background:none;
  border:1px solid var(--border);
  color:var(--text);
  text-align:left;
  margin-bottom:10px;
}

.sidebar-btn:hover{
  background:#222;
}

#history{
  flex:1;
  overflow-y:auto;
}

.history-item{
  padding:8px;
  border-radius:6px;
  cursor:pointer;
  color:var(--muted);
}

.history-item:hover{
  background:#222;
  color:var(--text);
}

/* ---------- MAIN ---------- */
#main{
  flex:1;
  display:flex;
  flex-direction:column;
}

#topbar{
  height:56px;
  display:flex;
  align-items:center;
  padding:0 16px;
  border-bottom:1px solid var(--border);
}

#menu{
  display:none;
  font-size:20px;
  cursor:pointer;
  margin-right:10px;
}

#chat{
  flex:1;
  overflow-y:auto;
  padding:40px 16px;
  max-width:800px;
  margin:auto;
  width:100%;
}

.message{
  margin-bottom:20px;
  line-height:1.6;
}

.user{color:#fff}
.ai{color:#dcdcdc}

/* ---------- INPUT ---------- */
#inputBar{
  border-top:1px solid var(--border);
  padding:16px;
}

#inputWrap{
  max-width:800px;
  margin:auto;
  display:flex;
  gap:10px;
}

#prompt{
  flex:1;
  padding:14px;
  border-radius:10px;
  background:#1f1f1f;
  border:1px solid var(--border);
  color:white;
}

#send{
  padding:0 20px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}

/* ---------- SETTINGS ---------- */
#settings{
  position:fixed;
  top:60px;
  right:20px;
  width:260px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  display:none;
}

.setting{
  display:flex;
  justify-content:space-between;
  margin-bottom:12px;
}

/* ---------- MOBILE ---------- */
@media(max-width:768px){
  #sidebar{
    position:fixed;
    left:-260px;
    top:0;
    bottom:0;
    z-index:10;
    transition:.3s;
  }
  /* ---------- SETTINGS BUTTON (Minimal) ---------- */
#settingsBtn{
  margin-left:auto;
  width:22px;
  height:18px;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

#settingsBtn span{
  height:2px;
  width:100%;
  background:#bfbfbf;
  border-radius:2px;
  transition:0.3s;
}

#settingsBtn:hover span{
  background:white;
}

/* ---------- SETTINGS PANEL (Clean) ---------- */
#settings{
  position:fixed;
  top:64px;
  right:24px;
  width:240px;
  background:#111;
  border:1px solid #262626;
  border-radius:14px;
  padding:14px;
  display:none;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}

.setting{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 6px;
  font-size:14px;
  color:#ddd;
}

.setting:not(:last-child){
  border-bottom:1px solid #1f1f1f;
}

/* Toggle style */
.setting input[type="checkbox"]{
  appearance:none;
  width:34px;
  height:18px;
  background:#333;
  border-radius:20px;
  position:relative;
  cursor:pointer;
}

.setting input[type="checkbox"]::before{
  content:"";
  width:14px;
  height:14px;
  background:#aaa;
  border-radius:50%;
  position:absolute;
  top:2px;
  left:2px;
  transition:.3s;
}

.setting input[type="checkbox"]:checked{
  background:#3b82f6;
}

.setting input[type="checkbox"]:checked::before{
  left:18px;
  background:white;
}

.setting select{
  background:#1a1a1a;
  color:white;
  border:1px solid #2a2a2a;
  border-radius:6px;
  padding:4px 6px;
}

  #sidebar.open{left:0}
  #menu{display:block}
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar">
  <div id="brand">MORADO AI</div>
  <button class="sidebar-btn" onclick="newChat()">New Chat</button>
  <input id="search" placeholder="Search chats" style="padding:8px;border-radius:6px;background:#111;border:1px solid var(--border);color:white">
  <div id="history"></div>
</div>

<!-- MAIN -->
<div id="main">
  <div id="topbar">
    <span id="menu">☰</span>
    <span>MORADO AI</span>
    <div id="settingsBtn" onclick="toggleSettings()" title="Settings">
  <span></span>
  <span></span>
  <span></span>
</div>

  <div id="chat">
    <h2 style="text-align:center;color:var(--muted)">What’s on your mind today?</h2>
  </div>

  <div id="inputBar">
    <div id="inputWrap">
      <input id="prompt" placeholder="Ask anything">
      <button id="send">Send</button>
    </div>
  </div>
</div>

<!-- SETTINGS -->
<div id="settings">
  <div class="setting">
    <span>Voice</span><input type="checkbox" id="voiceToggle">
  </div>
  <div class="setting">
    <span>History</span><input type="checkbox" id="historyToggle" checked>
  </div>
  <div class="setting">
    <span>Model</span>
    <select id="model">
      <option value="morado-1">MORADO-1</option>
      <option value="morado-pro">MORADO-PRO</option>
    </select>
  </div>
</div>

<script>
/* ---------- BACKEND ---------- */
const BACKEND = "https://backend-k99w.onrender.com";

/* ---------- STATE ---------- */
let chats = JSON.parse(localStorage.getItem("chats")||"[]");
let currentModel = "morado-1";

/* ---------- UI ---------- */
const chatBox = document.getElementById("chat");
const historyBox = document.getElementById("history");

/* ---------- FUNCTIONS ---------- */
function renderHistory(){
  historyBox.innerHTML="";
  chats.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.textContent=c.title;
    div.onclick=()=>loadChat(i);
    historyBox.appendChild(div);
  });
}

function newChat(){
  chatBox.innerHTML="";
}

function loadChat(i){
  chatBox.innerHTML="";
  chats[i].messages.forEach(m=>{
    addMessage(m.text,m.role,false);
  });
}

function addMessage(text,role,save=true){
  const div=document.createElement("div");
  div.className="message "+role;
  div.textContent=text;
  chatBox.appendChild(div);
  chatBox.scrollTop=chatBox.scrollHeight;

  if(save){
    if(!chats.length || chats[chats.length-1].done){
      chats.push({title:text.slice(0,30),messages:[],done:false});
    }
    chats[chats.length-1].messages.push({role,text});
    localStorage.setItem("chats",JSON.stringify(chats));
    renderHistory();
  }
}

async function send(){
  const input=document.getElementById("prompt");
  const msg=input.value.trim();
  if(!msg) return;
  input.value="";
  addMessage(msg,"user");

  const res = await fetch(BACKEND+"/api/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:msg,model:currentModel})
  });

  const data = await res.json();
  addMessage(data.reply || "No response","ai");
}

/* ---------- SETTINGS ---------- */
function toggleSettings(){
  const s=document.getElementById("settings");
  s.style.display = s.style.display==="block"?"none":"block";
}

document.getElementById("model").onchange=e=>{
  currentModel=e.target.value;
};

/* ---------- EVENTS ---------- */
document.getElementById("send").onclick=send;
document.getElementById("prompt").onkeydown=e=>{if(e.key==="Enter")send()};
document.getElementById("menu").onclick=()=>document.getElementById("sidebar").classList.toggle("open");
document.getElementById("search").oninput=e=>{
  const v=e.target.value.toLowerCase();
  document.querySelectorAll(".history-item").forEach(i=>{
    i.style.display=i.textContent.toLowerCase().includes(v)?"block":"none";
  });
};

renderHistory();
</script>

</body>
</html>

